# 电能管理系统业务需求文档

## 一、参数计算逻辑

### 1.1 基础计算公式

1) 厂用电负荷 = 电力负荷 * 厂用电率
2) 总负荷 = 电力负荷 + 厂用电负荷
3) 热定电机组出力 = 热力负荷 * 电热比
4) 光伏出力 = 光照强度 * 光伏出力系数
5) 风机出力 = 风速 * 风机出力系数
6) 调峰机组出力 = min(总负荷 - 热定电机组出力 - 光伏出力 - 风机出力, 调峰机组最大出力）
7) 火电出力 = 热定电机组出力 + 调峰机组出力
8) 总出力 = 光伏出力 + 风机出力 + 火电出力
9) 下网负荷 = 总负荷 - 总出力

其中光伏出力系数和风机出力系数依据函数关系设置中风机出力函数和光伏出力函数确定，并在该设置页面增加调峰机组最大出力的设置用于计算。

### 1.2 调峰机组参数优化

在设置页面，调峰机组参数中增加最小出力设置，该输入值为'调峰机组最小出力'，并基于调峰机组最小出力修改调峰机组出力的计算逻辑。

增加或修改下列参数，以支持计算逻辑的变化：

1) 将参数"光伏出力"的名字修改为"光伏最大出力"，并复用原来光伏出力的计算逻辑
2) 将参数"风机出力"的名字修改为"风机最大出力"，并复用原来风机出力的计算逻辑
3) 增加调峰机组待定出力并按如下的公式进行计算：  
   调峰机组待定出力 = 总负荷 - 热定电机组出力 - 光伏最大出力 - 风机最大出力
4) 因为调峰机组的实际出力不能小于其最小出力，修改调峰机组出力的公式为：  
   调峰机组出力 = max(min(调峰机组待定出力, 调峰机组最大出力)，调峰机组最小出力）
5) 增加参数风机光伏放弃出力，计算公式如下：  
   风机光伏放弃出力 = max（调峰机组最小出力 - 调峰机组待定出力，0）
6) 增加弃光风率 = 风机光伏放弃出力 / （光伏最大出力 + 风机最大出力）

### 1.3 厂用电负荷计算逻辑修改

修改厂用电负荷的计算逻辑：
厂用电负荷 = 火电出力 * 厂用电率
其他计算公式和逻辑不变。

但这样会导致公式的循环引用，需要通过迭代处理计算出结果。

### 1.4 能量平衡扩展

在能量平衡中再增加计算 风机光伏实际出力，公式如下：
风机光伏实际出力 = （光伏最大出力 + 风机最大出力）- 风机光伏放弃出力
其他计算都不变。

## 二、建立项目管理体系

1) 在进入该计算系统后，首先进入项目管理页面，支持新建计算项目
2) 在项目管理页面，以列表形式展示已创建的计算项目，并支持项目的查看、编辑和删除
3) 新建、查看项目后进入当前的包括数据、设置和结果的界面
4) 支持项目的导入数据、设置和结果的保存，以便后续的查看和修改
5) 在项目管理页的项目表格中，增加一列操作列，把打开项目和删除项目发到这个操作列上，并支持对于项目名称的编辑
6) 在操作列上增加复制项目按钮，以支持改项目的复制，点击后输入项目名称并复制为一个新的项目

## 三、使用地域位置自动生成7860风速和光照强度数据

## 四、检修及投产过程对于负荷和出力的影响

在设置页面后面增加一个页签，名字为检修和投产计划，在该页面利用表格来管理负荷以及出力设备的检修和投产计划。

### 4.1 检修计划

分为上下两个表格，一个为检修计划，另一个投产计划。

对于检修计划表格，支持增加、编辑、删除检修计划条目：

- 增加和编辑检修计划时需输入影响负荷出力类型，影响负荷出力大小，开始日期和结束日期。

### 4.2 投产计划

对于投产计划表格，支持增加、编辑、删除投产计划条目：

- 增加和编辑投产计划时需输入影响负荷出力类型，影响负荷出力大小，开始日期和结束日期。

### 4.3 负荷出力类型分类

负荷出力类型分为光伏出力、风机出力、调峰机组出力和用电负荷4种：

- 选择光伏出力和风机出力类型后需进一步选择设备型号

先不要调整任何出力负荷平衡的算法，后续再定义。

## 五、负荷数据的导入

## 六、基于检修计划对负荷出力的修正

在检修开始日期（含）和结束日期间（含），基于检修计划对负荷和出力的计算进行修正：

1) 对于影响负荷出力类型为调峰机组出力时，基于影响负荷出力大小的数值对 调峰机组的最大出力和最小出力进行修正，修正方法如下：
   - 新最大出力 = 原最大出力 - 影响负荷出力大小
   - 新最小出力 = 原最小出力 * （新最大出力/原最大出力）

2) 对于影响负荷出力类型为用电负荷时，基于影响负荷出力大小的数值对 电力负荷进行修正，修正方法如下：
   - 新电力负荷 = 原电力负荷 / 最大负荷 * （最大负荷 - 影响负荷出力大小）

3) 对于影响负荷出力类型为光伏出力和风机出力时，暂不修正

对于非检修时间，不进行修正。有多条检修计划，进行叠加修正，例如有两条检修计划，即先基于第一条修正完了之后再在第一个修正完的结果上再基于第二条计划修正。保证其余功能不变。

## 七、对检修和投产计划功能进行修订

1) 增加检修和投产计划的名称，保留数据库已有的检修和投产计划，并以顺序数字命名
2) 将投产计划里 影响负荷出力类型里面的'调峰机组出力'类别拆分为 "调峰机组最大出力"和 "调峰机组最小出力"
3) 在投产计划里取消添加投产计划条目里影响负荷出力类型里面的'光伏出力'和"风机出力" 下的级联设备型号选择
4) 基于配置类型、影响出力负荷大小以及开始和结束日期对相应的出力负荷进行修正，修正方法如下：

### 7.1 光伏出力和风机出力修正
在投产开始日期前，其最大出力修正公式为：
- 修正最大出力 = 原最大出力 * （设置中的装机容量- 影响负荷出力大小）/ 设置中的装机容量

在投产结束日期后，其最大出力修正公式为：
- 修正最大出力 = 原最大出力

在投产开始日期和结束日期之间，采用线性插值。

### 7.2 电力负荷修正
在投产开始日期前，修正的电力负荷为原电力负荷减去设置的影响出力负荷大小，投产结束日后，修正的电力负荷即为原电力负荷，在投产期间，采用线性变化。

### 7.3 调峰机组最大负荷修正
在投产开始日期前，修正的调峰机组最大负荷为原调峰机组最大负荷减去设置的影响出力负荷大小，投产结束日后，修正的调峰机组最大负荷即为原调峰机组最大负荷，在投产期间，采用线性变化。即最大负荷随着投产进行逐步增大。

### 7.4 调峰机组最小负荷修正
在投产开始日期前，修正的调峰机组最小负荷为原调峰机组最小负荷，投产结束日后，修正的调峰机组最小负荷即为原调峰机组最小负荷减去设置的影响出力负荷大小，在投产期间，采用线性变化。即最小负荷随着投产进行逐步减小。

后续的能量平衡计算要基于检修和投产计划的修正进行。保证其他功能不变。

## 八、装机容量计算和显示

在设置的风机型号管理和光伏型号管理里面计算并显示风机的总装机容量和光伏的总装机容量：

1) 风机的总装机容量 = 每个型号的装机容量相加得到  
   其中每个型号的装机容量 = 额定功率 × 风机数量

2) 光伏的总装机容量 = 每个型号的装机容量相加得到  
   其中面积效率法型号的装机容量 = 光伏板面积 × 光伏板效率 × 光伏板数量  
   其中装机容量型号的装机容量 = 装机容量 × 光伏板数量

## 九、出力限制计划

在检修和投产计划页面的检修计划以及投产计划的基础上，增加一个出力限制计划：

1) 同样支持出力限制计划的添加、删除和编辑
2) 出力限制计划条目包括计划名称、类型、出力大小、开始日期和结束日期
3) 其中类型包括 光伏最大出力限制和风机最大出力限制
4) 在计算光伏或者风机最大出力时，利用原有的光伏或者风机最大出力计算结果与设定的最大出力限制比较，取两者的小值作为修正后的最大出力
5) 该计算方法仅在调试日期内生效
6) 同一类型有多条调试计划条目的：

   6-1）若日期没有互相覆盖，则分时间段应用出力限制，
   
   6-2）若日期存在互相覆盖，则在覆盖日期取最小的出力限制作为参与比较的出力限制

## 十、计算结果按月度汇总

修改输出的excel文件，保留目前的总用电量、总发电量、下网电量、弃电量、弃风光率的基础上，再增加如下月度统计量：

1) 光伏风电消纳电量，即根据该月份的风机光伏实际出力累加得到，单位kWh
2) 火电发电量，即根据该月份的火电出力累加得到，单位kWh
3) 厂用电量，即根据该月份的厂用电负荷累加得到，单位kWh
4) 光伏风电发电量，根据该月份的 光伏最大出力和风机最大出力的和，再累加得到

并调整顺序，按照 总用电量、总发电量、火电发电量、厂用电量、光伏风电发电量、光伏风电消纳电量、弃电量、下网电量、弃风光率从左到右排列。并增加相应的年度汇总。

## 十一、灵活负荷

1) 在设置页面最大负荷设置右侧增加一个灵活负荷设置，设置最大灵活负荷和最小灵活负荷，单位kW, 默认值都为0
2) 基于设置的最大灵活负荷和最小灵活负荷进行消纳和风机光伏放弃出力后续计算, 计算逻辑如下：

   2-1）当光伏及风力放弃出力小于最小灵活负荷时，灵活负荷不启动，不消纳；
   
   2-2）当光伏及风力放弃出力大于等于最小灵活负荷时，小于等于最大灵活负荷时，所有放弃出力都被灵活负荷消纳
   
   2-3) 当光伏及风放弃出力大于最大灵活负荷时，新消纳的出力等于最大灵活负荷，剩余部分出力继续放弃

在增加了灵活负荷后修正计算结果中风机光伏放弃出力，公式如下：
- 新的风机光伏放弃出力 = 原风机光伏放弃出力 - 新增的灵活负荷消纳出力

- 下网负荷 = 总负荷 + 新增的灵活负荷消纳出力 - 总出力

- 新的光伏风电实际出力 = （光伏最大出力 + 风机最大出力）- 新的风机光伏放弃出力

根据新的风机光伏放弃出力、实际出力修改汇总页面的光伏风电弃电量、消纳电量以及弃风光率。

## 十二、弱化年份信息

取消输入数据、检修计划、投产计划、调试计划以及输出结果中的年份信息，不需要输入也不输出。
检修计划、投产计划、调试计划和输入数据都默认为同一年。
输入数据中有年份信息的，导入后忽略。
对项目的历史数据、数据库中数据也同步修改为相关的包含年份的日期形式也修改为MM-DD形式。
图表和页面显示的地方也使用MM-DD即可。

## 十三、基于收益的负荷优化

### 13.1 数据导入增强
在数据页面，在使用csv数据导入时，在csv文件中增加一列输入，实现下网电价7860小时数据的导入。
没有下网电价时，默认为0；
下网电价单位为：元/kWh；
导入后与原有的电力负荷等数据做同样的保存和显示处理。

### 13.2 理论情况下最佳经济运行策略研究

①全系统的技术模型和经济模型构建：须针对在建的阜康25+50万千瓦光伏新能源直连项目和在建的托克逊115万千瓦风电新能源直连项目，在直连项目启动前，委派专人进行现场调研收资，通过收集园区火电和新能源生产运行数据及财务成本数据，建立全系统的技术模型和经济模型。

②生产运行模拟与运行策略研究：须运用技术手段模拟实际生产运行情况，开展不同情景、不同边界条件下的运行成本测算，形成各项目理论情况下最佳经济运行策略，编制形成初步理论性的《协同运行技术分析及运营策略研究》报告。

### 13.3 实际最佳经济运行策略研究

①全系统的技术模型和经济模型修正：须在理论运行策略基础上，通过开展一年期实际运行数据监测分析，对全系统的技术模型和经济模型进行修正。

②实际经济运行策略研究与建议：须基于修正模型，形成实际最佳经济运行策略，同时给出优化新能源直连项目消纳与成本控制的建议。

### 13.4 优化
1. 在目前的结果页签右侧再增加一个优化页签，用于进行负荷调配优化。
2. 在优化页签下增加如下的输入框，用于输入优化的参数，包括
   1. 基础负荷单位收益 默认值：1， 单位：元/kWh
   2. 灵活负荷单位收益 默认值：0.8 元/kWh
   3. 火电发电单位成本 默认值：0.2 元/kWh
   4. 光伏发电单位成本 默认值：0.05 元/kWh
   5. 风机发电单位成本 默认值：0.05 元/kWh
保证系统其他功能不变
   6. 
### 13.5 优化计算
在平衡计算的基础上进行优化计算。
即通过调整8760小时中每一个小时基础负荷和灵活负荷的大小，基础负荷就是原来的电力负荷。来实现每个小时的收益最大。收益的定义如下：
收益 = 基础负荷 × 基础负荷单位收益 + 灵活负荷 × 灵活负荷单位收益 - 火力发电负荷 × 火电发电单位成本 - 光伏发电负荷 × 光伏发电单位成本 - 风机发电负荷 × 风机发电单位成本 - 下网负荷 × 下网电价
基础负荷优化边界的最大值为平衡计算得到的电力负荷（考虑了检修），最小值为0，
灵活负荷优化边界的最大值机组设置中最大灵活负荷，最小值为机组设置中最小灵活负荷
输入结果中增加基础负荷优化值列和灵活负荷优化值列。


### todo
1. 优化参数设置的没有进行持久化保持，修改保存后返回项目列表时会丢失，需要重新设置。  done
2. 需要增加单独保存优化参数的按钮，以实现单独保存而不返回项目列表。 done
3. 在优化结果下方增加趋势图的显示，趋势图包括优化前后的基础负荷、优化前后的灵活负荷以及优化前后下网负荷。图表的配置和前面的平衡计算结果可视化展示图表一致。done
4. 在优化计算过程中增加进度条显示，并实时显示进度。
5. 优化计算时，如果没有进行过平衡计算，则先触发平衡计算后再进行优化计算。
6. 各页面的按钮优化
7. 考虑负荷优化的边界条件
   1. 比如负荷加减速率，以保证优化结果的平顺性
   2. 增加开关，明确是否可以上网，若不可以，则下网负荷不能小于零
8. 鼠标悬浮在趋势图上时，显示当前悬浮位置的时间和值，图表包括数据导入图表，平衡计算结果可视化图表，优化结果可视化图表。
